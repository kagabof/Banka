{"version":3,"sources":["transactionController.js"],"names":["TransactionController","req","res","accountNumber","parseInt","params","account","amount","parseFloat","body","cachierId","accountFound","accountIndex","accountDb","map","index","status","send","error","balance","newTransaction","id","transactionDb","length","creatOn","Date","now","type","accountNmber","cachier","oldBalance","newBalance","push","newAccount","createOn","owner","splice","data","transactionId","transactionType","accountBalance","find","TaccountN","ac","tru","some","filter","accountN","accountFound1","transactionFound","transactionIndex","account1","trans","tran"],"mappings":"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","file":"transactionController.js","sourceRoot":"/home/kagabo/banka1/Banka/server/controllers","sourcesContent":["import userDb from \"./../db/userDB\";\nimport accountDb from \"./../db/accountDB\";\nimport transactionDb from \"./../db/transactionDB\";\n\nclass TransactionController{\n    debiteAccount(req,res){\n        const accountNumber = parseInt(req.params.account);\n        const amount = parseFloat(req.body.amount);\n        const cachierId = parseInt(req.body.cachierId);\n\n        let accountFound;\n        let accountIndex;\n\n        accountDb.map((account, index) => {\n            if (account.accountNumber === accountNumber) {\n                accountFound = account;\n                accountIndex = index;\n            }\n\n        }); \n\n        if (!accountNumber){\n            return res.status(400).send({\n                status: 400,\n                error: \"account required\",\n            }); \n        }else if(!amount){\n            return res.status(400).send({\n                status: 400,\n                error: \"amount required\",\n            });\n        } else if (!accountFound) {\n            return res.status(400).send({\n                status: 400,\n                error: \"account not found\",\n            });\n        } else if (accountFound.balance < amount) {\n            return res.status(400).send({\n                status: 400,\n                error: \"balance is less than the amount\",\n            });\n        }else {\n            const newTransaction = {\n                id: transactionDb.length + 1,\n                creatOn: Date.now(),\n                type: \"debit\",\n                accountNmber: accountNumber,\n                cachier: cachierId,\n                amount: amount,\n                oldBalance: accountFound.balance,\n                newBalance: accountFound.balance - amount,\n            };\n\n            transactionDb.push(newTransaction);\n\n            const newAccount = {\n                id: accountFound.id,\n                accountNumber: accountNumber,\n                createOn: accountFound.createOn,\n                owner: accountFound.owner,\n                type: accountFound.type,\n                status: accountFound.status,\n                balance: accountFound.balance - amount,\n            };\n            accountDb.splice(accountIndex,1,newAccount);\n            return res.status(201).send({\n                status: 201,\n                error: \"true\",\n                data: {\n                    transactionId: newTransaction.id,\n                    accountNumber: accountNumber,\n                    amount: amount,\n                    cachier: cachierId,\n                    transactionType: newTransaction.type,\n                    oldBalance: accountFound.balance,\n                    accountBalance: newAccount.balance,\n                }\n            });\n        }\n    }\n\n    creditAccount(req, res) {\n        const accountNumber = parseInt(req.params.account);\n        const amount = parseFloat(req.body.amount);\n        const cachierId = parseInt(req.body.cachierId);\n\n        let accountFound;\n        let accountIndex;\n\n        accountDb.map((account, index) => {\n            if (account.accountNumber === accountNumber) {\n                accountFound = account;\n                accountIndex = index;\n            }\n\n        });\n\n        if (!accountNumber) {\n            return res.status(400).send({\n                status: 400,\n                error: \"account required\",\n            });\n        } else if (!amount) {\n            return res.status(400).send({\n                status: 400,\n                error: \"amount required\",\n            });\n        } else if (!accountFound) {\n            return res.status(400).send({\n                status: 400,\n                error: \"account not found\",\n            });\n        } else {\n            const newTransaction = {\n                id: transactionDb.length + 1,\n                creatOn: Date.now(),\n                type: \"debit\",\n                accountNmber: accountNumber,\n                cachier: cachierId,\n                amount: amount,\n                oldBalance: accountFound.balance,\n                newBalance: accountFound.balance - amount,\n            };\n\n            transactionDb.push(newTransaction);\n\n            const newAccount = {\n                id: accountDb.id,\n                accountNumber: accountNumber,\n                createOn: accountDb.createOn,\n                owner: accountDb.owner,\n                type: accountDb.type,\n                status: accountDb.status,\n                balance: accountFound.balance + amount,\n            };\n            accountDb.splice(accountIndex,1,newAccount);\n            \n            return res.status(201).send({\n                status: 201,\n                data: {\n                    transactionId: newTransaction.id,\n                    accountNumber: accountNumber,\n                    amount: amount,\n                    cachier: cachierId,\n                    transactionType: newTransaction.type,\n                    oldBalance: accountFound.balance,\n                    accountBalance: newAccount.balance,\n                }\n            });\n        }\n    }\n    getAllTransaction(req, res) {\n        return res.status(200).send({\n            status: 200,\n            data: transactionDb\n        })\n    }\n\n    getAllTransactionFoAccount(req, res) {\n        const accountNumber = parseInt(req.params.accountNumber);\n        const account = accountDb.find(account => account.accountNumber === accountNumber);\n        const TaccountN = transactionDb.find(ac => ac.accountNumber === accountNumber);\n        const tru = accountDb.some(ac => ac.accountNumber === accountNumber);\n        const accountFound = transactionDb.filter((accountN) =>accountN.accountNumber === accountNumber)\n        \n        let accountFound1;\n        let accountIndex;\n        let transactionFound;\n        let transactionIndex;\n\n        accountDb.map((account1, index) => {\n            if (account1.accountNumber === accountNumber) {\n                accountFound1 = account1;\n                accountIndex = index;\n            }\n        });\n\n        transactionDb.map((trans, index)=>{\n            if(trans.accountNumber === accountNumber){\n                transactionFound = trans;\n                transactionIndex = index;\n            }\n        });\n        if (account){\n            return res.status(200).send({\n                status: 200,\n                data: accountFound,\n            });\n        }\n            \n        \n    }\n}\n\nconst tran = new TransactionController();\n\nexport default tran;"]}